(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{549:function(t,e,n){"use strict";n.r(e);n(269),n(30);var o={head:function(){return{title:"日常用到的小工具-小说搜索阅读",link:[{rel:"stylesheet",href:"./css/book/index.css"}]}},data:function(){return{value:"",books:[{title:"书名",render:function(t,e){return t("span",e.row.name.bookName)}},{title:"最新章节",render:function(t,e){return t("span",e.row.new.articleName)}},{title:"作者",key:"author"},{title:"最近更新",key:"date"}],list:[],info:"",bookLink:"",articleName:"",content:"",thisArticleLink:"",nextArticleLink:"",left:!1,right:!1,scroll:!0,loading:!1,history:[]}},mounted:function(){var t=this;this.$nextTick((function(){t.$refs.book.addEventListener("scroll",t.handleScroll,!1),t.$refs.book.addEventListener("resize",t.handleScroll,!1)}));var e=window.localStorage.getItem("record");e&&(this.history=JSON.parse(e),this.$store.dispatch("book/setRead",this.history))},methods:{enter:function(){var t=this,e=t.value.trim();e?t.$axios.get("myTools/api/search",{params:{searchkey:e}}).then((function(e){console.log(e.data),e.data.length>0?t.list=e.data:t.$Message.warning("查无此书！")})):t.list.length=0},onRowClick:function(t,e){this.loading=!0,this.getInfo(t.name.link,!0)},getInfo:function(link,t){var e=this;this.$axios.get("myTools/api/info",{params:{link:link}}).then((function(n){console.log(n.data),n.data.bookName&&(e.info=n.data,e.bookLink=link),e.loading=!1,t&&(e.right=!0)}))},getContent:function(link){var t=this;t.scroll&&t.content&&this.$nextTick((function(){document.getElementById("content").scrollIntoView()})),t.$axios.get("myTools/api/article",{params:{link:link}}).then((function(e){if(console.log(e.data),e.data.articleContent){if(t.articleName=e.data.articleName,t.scroll)t.content=e.data.articleContent;else if(t.content+=e.data.articleContent,t.nextArticleLink=e.data.nextArticleLink,t.thisArticleLink=link,t.info.bookName){var data={bookName:t.info.bookName,bookLink:t.bookLink,articleName:t.articleName,articleLink:link};t.$store.dispatch("book/pushRead",data)}}else t.$Message.warning("获取下一章节内容失败！");t.scroll=!0}))},onMouseMove:function(t){t.clientX<2&&(this.left=!0)},handleScroll:function(t){this.scroll&&t.target.scrollHeight-t.target.clientHeight-t.target.scrollTop==0&&(this.scroll=!1,this.getContent(this.nextArticleLink))},dblclick:function(){this.info.list?(this.right=!0,this.$nextTick((function(){document.getElementById("select").scrollIntoView({behavior:"smooth",block:"center"})}))):this.$Message.warning("目录过长正在加载中！")},getHistory:function(data){this.getContent(data.articleLink),this.getInfo(data.bookLink)},removeHistory:function(t){this.$store.dispatch("book/removeRead",t)}}},l=n(40),component=Object(l.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"book",staticClass:"book",on:{dblclick:t.dblclick,mousemove:t.onMouseMove}},[t.content?n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{attrs:{span:"16",id:"articleName"}},[n("p",{attrs:{align:"right"}},[t._v(t._s(t.articleName))])]),t._v(" "),n("Col",{attrs:{id:"content",span:"16"},domProps:{innerHTML:t._s(t.content)}})],1):t._e(),t._v(" "),n("Drawer",{attrs:{title:"输入书名或作者名",placement:"left",closable:!1,width:"40"},model:{value:t.left,callback:function(e){t.left=e},expression:"left"}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{attrs:{span:"24"}},[n("Input",{attrs:{placeholder:"输入书名或作者名",size:"large",autofocus:""},on:{"on-enter":t.enter},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),t._v(" "),t.list.length>0?n("Col",{attrs:{span:"24"}},[n("Table",{attrs:{loading:t.loading,columns:t.books,data:t.list},on:{"on-row-click":t.onRowClick}})],1):t._e(),t._v(" "),t.history.length>0?n("Col",{attrs:{span:"24"}},t._l(t.history,(function(e,o){return n("Card",{key:o,attrs:{"dis-hover":""}},[n("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.bookName)+"\n                        "),n("Icon",{staticStyle:{cursor:"pointer",float:"right"},attrs:{size:"22",type:"ios-trash-outline"},on:{click:function(e){return t.removeHistory(o)}}})],1),t._v(" "),n("p",{staticClass:"ivu-select-item",on:{click:function(n){return t.getHistory(e)}}},[t._v(t._s(e.articleName))])])})),1):t._e()],1)],1),t._v(" "),n("Drawer",{attrs:{title:"小说目录",placement:"right",closable:!1,width:"25"},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{attrs:{span:"24"}},[n("Card",{attrs:{bordered:!1}},[n("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.info.bookName))]),t._v(" "),n("Row",[n("Col",{attrs:{span:"8"}},[n("img",{staticClass:"cover",attrs:{src:t.info.cover,alt:""}})]),t._v(" "),n("Col",{attrs:{span:"16"}},[n("p",[t._v(t._s(t.info.author))]),t._v(" "),n("p",[t._v(t._s(t.info.date))]),t._v(" "),n("p",[t._v("最新章节："+t._s(t.info.newArticle))])])],1)],1)],1),t._v(" "),n("Col",{attrs:{span:"22"}},t._l(t.info.list,(function(e,o){return n("p",{key:o,staticClass:"ivu-select-item",attrs:{id:e.link===t.thisArticleLink?"select":""},on:{click:function(n){return t.getContent(e.link)}}},[t._v(t._s(++o+" "+e.name))])})),0)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);